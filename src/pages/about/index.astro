---
import PlayerLayout from "../../layouts/PlayerLayout.astro";
import { Sidebar } from "../../components/Sidebar";
import type { ArtistData, SongData, VideoData } from "../../lib/types";

import artistsJson from "../../../public/artists.json";
import songsJson from "../../../public/songs.json";

const videoModules = import.meta.glob("../../../public/videos/*.json", {
  eager: true,
});
const videos = Object.values(videoModules) as VideoData[];

const artists = artistsJson.artists as ArtistData[];
const songs = songsJson.songs as SongData[];

const playCounts: Record<string, number> = {};
videos.forEach((video) => {
  video.timestamps.forEach((timestamp) => {
    const songId = timestamp.song_id;
    playCounts[songId] = (playCounts[songId] || 0) + 1;
  });
});

const enrichedSongs = songs.map((song) => {
  const artistNames = song.artist_ids
    .map((id) => {
      const artist = artists.find((a) => a.artist_id === id);
      return artist ? artist.name : "";
    })
    .filter(Boolean);

  return {
    ...song,
    artist_names: artistNames,
    artist_name: artistNames.join(", ") || "",
    count: playCounts[song.song_id] || 0,
  };
});

const artistsMap: Record<string, string> = {};
artists.forEach((artist) => {
  artistsMap[artist.artist_id] = artist.name;
});
---

<PlayerLayout title="このサイトについて | Nanashino Sayo player">
  <Sidebar
    slot="sidebar"
    videos={videos}
    songs={enrichedSongs}
    artists={artistsMap}
    client:load
  />

  <div class="flex justify-center w-full">
    <div class="w-full max-w-[90%] mx-auto p-4 sm:p-6 space-y-6 sm:space-y-8">
      <h1 class="text-2xl sm:text-3xl font-bold">このサイトについて</h1>
      <div class="space-y-4 text-base sm:text-lg text-muted-foreground">
        <p>
          これは Vsinger「<a
            class="font-bold text-blue-600 no-underline"
            href="https://www.youtube.com/@nanasayo09">七篠さよ</a
          >」の YouTube
          ライブ配信のうち「歌枠」をタイトルに含むアーカイブ動画を再生するための非公式
          Web サイトです。
        </p>
        <p>
          再生を開始するには、サイドバーの Archives
          タブから動画を選択してください。
        </p>
        <p>
          サイドバーの Songs
          タブから曲を選択すると、その曲を歌ったアーカイブ動画の一覧が表示されます。
        </p>
        <p>
          本サイトは GitHub の <a
            href="https://github.com/6r-rd/nanashino-sayo-player"
            target="_blank"
            class="hover:underline">6r-rd/nanashino-sayo-player</a
          > という public リポジトリで開発および運用されています。ご意見やご指摘は
          GitHub Issue にてご連絡ください。
        </p>
      </div>
      <h2 class="text-xl sm:text-2xl font-bold">七篠さよについて</h2>
      <div class="space-y-4 text-base sm:text-lg text-muted-foreground">
        <p>
          公式 YouTube チャンネル <a
            href="https://www.youtube.com/@nanasayo09"
            target="_blank"
            class="hover:underline">https://www.youtube.com/@nanasayo09</a
          > または公式 X アカウント <a
            href="https://x.com/nanasayo09"
            target="_blank"
            class="hover:underline">https://x.com/nanasayo09</a
          >
          をご覧ください。
        </p>
      </div>
      <div></div>
    </div>
  </div>
</PlayerLayout>
